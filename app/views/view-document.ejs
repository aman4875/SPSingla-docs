<!DOCTYPE html>
<html lang="zxx" class="js">
	<head>
		<meta charset="utf-8" />
		<meta name="author" content="Softnio" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
		<meta name="description"  />
		<link rel="shortcut icon" href="./images/favicon.png" />
		<title>Documents | Document Controller</title>
		<link rel="stylesheet" href="/app/assets/css/dashlite.css" />
		<link id="skin-default" rel="stylesheet" href="/app/assets/css/theme.css" />
	</head>

	<body class="nk-body bg-lighter npc-general has-sidebar">
		<style>
			.is-compact .data-item {
				padding-top: 6px;
				padding-bottom: 6px;
			}
			.data-value{
				color: black;
				font-size: 13px;
			}
		</style>
		<div class="nk-app-root">
			<!-- main @s -->
			<div class="nk-main">
				<%- include('./common/sidebar' , {active : "Documents"}); -%>
				<div class="nk-wrap">
					<%- include('./common/navbar'); -%>
					<div class="nk-content">
						<div class="container-fluid">
							<div class="nk-content-inner">
								<div class="nk-content-body">
									<div class="nk-block-head nk-block-head-sm">
										<div class="nk-block-between g-3">
											<div class="nk-block-head-content">
												<h4 class="nk-block-title page-title">Document - <strong class="text-primary small"><%=documentData.doc_number%></strong></h4>
											</div>
											<div class="nk-block-head-content">
												<a href="/documents" class="btn btn-outline-light bg-white d-none d-sm-inline-flex"><em class="icon ni ni-arrow-left"></em><span>Back</span></a>
											</div>
										</div>
									</div>
									<!-- .nk-block-head -->
									<div class="nk-block">
										<div class="row gy-5">
											<div class="col-lg-8">
												<div class="nk-block-head">
													<div class="nk-block-head-content">
														<h5 class="nk-block-title title">Document Information</h5>
													</div>
												</div>
												<div class="card card-bordered" style="max-height: 600px; overflow-y: scroll; overflow-x: hidden;">
													<ul class="data-list is-compact">
														<li class="data-item">
															<div class="data-col">
																<div class="data-label">Document Site</div>
																<div class="data-value"><%= documentData.doc_site ? documentData.doc_site : '-' %></div>
															</div>
														</li>
														<li class="data-item">
															<div class="data-col">
																<div class="data-label">Document Folder</div>
																<div class="data-value">
																	<%= documentData.doc_folder ? documentData.doc_folder.split('-').pop().trim() : '-' %>
																</div>
															</div>
														</li>
														
														<li class="data-item">
															<div class="data-col">
																<div class="data-label">Document Number</div>
																<div class="data-value"><%= documentData.doc_number ? documentData.doc_number : '-' %></div>
															</div>
														</li>
														<li class="data-item">
															<div class="data-col">
																<div class="data-label">Document Type</div>
																<div class="data-value"><%= documentData.doc_type ? documentData.doc_type : '-' %></div>
															</div>
														</li>
														<li class="data-item">
															<div class="data-col">
																<div class="data-label">Document Subject</div>
																<div class="data-value"><%= documentData.doc_subject ? documentData.doc_subject : '-' %></div>
															</div>
														</li>
														<li class="data-item">
															<div class="data-col">
																<div class="data-label">Document Reference</div>
																<div class="data-value"><%= documentData.doc_reference ? documentData.doc_reference : '-' %></div>
															</div>
														</li>
														<li class="data-item">
															<div class="data-col">
																<div class="data-label">Document Replied Vide</div>
																<div class="data-value"><%= documentData.doc_replied_vide ? documentData.doc_replied_vide : '-' %></div>
															</div>
														</li>
														<li class="data-item">
															<div class="data-col">
																<div class="data-label">Document Purpose</div>
																<div class="data-value"><%= documentData.doc_purpose ? documentData.doc_purpose : '-' %></div>
															</div>
														</li>
														<li class="data-item">
															<div class="data-col">
																<div class="data-label">Document Storage Location</div>
																<div class="data-value"><%= documentData.doc_storage_location ? documentData.doc_storage_location : '-' %></div>
															</div>
														</li>
														<li class="data-item">
															<div class="data-col">
																<div class="data-label">Document From</div>
																<div class="data-value"><%= documentData.doc_from ? documentData.doc_from : '-' %></div>
															</div>
														</li>
														<li class="data-item">
															<div class="data-col">
																<div class="data-label">Document To</div>
																<div class="data-value"><%= documentData.doc_to ? documentData.doc_to : '-' %></div>
															</div>
														</li>
													</ul>
													
												</div>
											</div>
											<div class="col-lg-4">
												<div class="nk-block-head">
													<div class="nk-block-head-content">
														<h5 class="nk-block-title title">Basic Info</h5>
													</div>
												</div>
												<!-- .nk-block-head -->
												<div class="card card-bordered">
													<ul class="data-list is-compact">
														<li class="data-item">
															<div class="data-col">
																<div class="data-label">Document File</div>

																<div class="data-value"><a  target="_blank" class="btn btn-sm btn-dim  btn-outline-primary" href="<%=documentData.doc_pdf_link%>">View File</a></div>
															</div>
														</li>
														<li class="data-item">
															<div class="data-col">
																<div class="data-label">Document Date</div>
																<div class="data-value"><%= documentData.doc_created_at ? documentData.doc_created_at : '-' %></div>
															</div>
														</li>
														<li class="data-item">
															<div class="data-col">
																<div class="data-label">Document Status</div>
																<div class="data-value"><span class="badge badge-dim badge-sm bg-outline-success"><%= documentData.doc_status ? documentData.doc_status : '-' %></span></div>
															</div>
														</li>
														<li class="data-item">
															<div class="data-col">
																<div class="data-label">Document Pages</div>
																<div class="data-value"><%= documentData.doc_ocr_pages ? documentData.doc_ocr_pages : '-' %></div>
															</div>
														</li>
														<li class="data-item">
															<div class="data-col">
																<div class="data-label">Uploaded By</div>
																<div class="data-value"><%= documentData.doc_uploaded_by ? documentData.doc_uploaded_by : '-' %></div>
															</div>
														</li>
														<li class="data-item">
															<div class="data-col">
																<div class="data-label">Upload Date</div>
																<div class="data-value"><%= documentData.doc_uploaded_at ? documentData.doc_uploaded_at : '-' %></div>
															</div>
														</li>
													</ul>
												</div>
												<!-- .card -->
												
											</div>
										</div>
										<div class="row gy-5" style="margin-top: 5px;">
											<div class="col-lg-12">
												<div class="nk-block-head">
													<div class="nk-block-head-content">
														<h5 class="nk-block-title title">Attachments <button id="addAttachmentButton" data-bs-toggle="modal" data-bs-target="#attachmentModal" style="margin-left: 10px;margin-bottom: 8px;" class="btn btn-sm btn-dim  btn-outline-primary" >Add Attachments</button></h5>
														
													</div>
												</div>
												<div class="card card-bordered card-preview">
													<table class="table table-bordered">
														<thead>
															<tr>
																<th scope="col">#</th>
																<th scope="col">Attachment Name</th>
																<th scope="col">Upload Date</th>
																<th scope="col">Actions</th>
															</tr>
														</thead>
														<tbody>
															<% if (docAttachments && docAttachments.length > 0) { %>
															  <% docAttachments.forEach((attachment, index) => { %>
																<tr>
																  <th scope="row"><%= index + 1 %></th>
																  <td><%= attachment.daj_attachment_name %></td>
																  <td><%= attachment.daj_attachment_upload_date %></td>
																  <td>
																	<a href="<%= attachment.daj_attachment_link %>" target="_blank" class="btn btn-sm btn-outline-primary">View</a>
																  </td>
																</tr>
															  <% }); %>
															<% } else { %>
															  <tr>
																<th scope="row">1</th>
																<td>none</td>
																<td>none</td>
																<td>
																  <button class="btn btn-sm btn-outline-secondary" disabled>No Link</button>
																</td>
															  </tr>
															<% } %>
														  </tbody>
														  
													</table>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<%- include('./common/footer'); -%>
				</div>
			</div>
		</div>
		<div class="modal fade" id="attachmentModal">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Add Attachment</h5>
						<a href="#" class="close" data-bs-dismiss="modal" aria-label="Close">
							<em class="icon ni ni-cross"></em>
						</a>
					</div>
					<div class="modal-body" style="padding: 1.25rem">
						<form id="attachmentForm" class="form-validate is-alter">
							<div class="form-group">
								<label class="form-label" for="doc_attachment">Attachment Name</label>
								<div class="form-control-wrap">
									<input type="text" placeholder="Attachment Name" class="form-control" name="doc_attachment" id="doc_attachment" required />
								</div>
							</div>
							<div class="form-group">
                                <label class="form-label" for="doc_file">Upload PDF</label>
                                <div class="form-control-wrap">
                                  <input type="file" class="form-control" placeholder="Upload File" id="doc_file" name="doc_file" required />
                                </div>
                            </div>
							<input type="hidden" name="doc_number" id="doc_number" value="<%=documentData.doc_number%>">
							<div class="form-group" style="display: flex; justify-content: space-between">
								<button data-bs-dismiss="modal" type="button" aria-label="Close" class="btn btn-light">Cancel</button>
								<button id="uploadAttachmentButton" class="btn btn-primary">Upload Attachment</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
		<script src="/app/assets/js/bundle.js"></script>
		<script src="/app/assets/js/scripts.js"></script>
		<script>
			$(document).ready(function() {
				$('#attachmentForm').on('submit', function(event) {
					event.preventDefault();
		
					var formData = new FormData(this);
		
					$.ajax({
						url: '/docs/upload-attachment',
						type: 'POST',
						data: formData,
						contentType: false,
						processData: false,
						success: function(response) {
							if (response.status === 1) {
								location.reload();
							} else {
								alert('Upload failed: ' + response.message);
							}
						},
						error: function(xhr, status, error) {
							console.error('Error:', error);
						}
					});
				});
				
				let documentNumber = $("#doc_number").val();
				if(documentNumber.length > 0){
					$.ajax({
						url: '/docs/record-document-viewed',
						type: 'POST',
						data: {
							"doc_number" : documentNumber
						},
						success: function(response) {
							console.log("SENT")
						},
						error: function(xhr, status, error) {
							console.error('Error:', error);
						}
					});
				}
			});
				
		</script>
	</body>
</html>
